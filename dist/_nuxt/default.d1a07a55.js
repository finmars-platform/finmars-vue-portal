var D=Object.defineProperty;var P=(l,e,t)=>e in l?D(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var x=(l,e,t)=>(P(l,typeof e!="symbol"?e+"":e,t),t);import{a as F,r as E,v as Y,o as s,f as a,F as h,y as C,c as g,w as d,m as I,t as u,u as i,l as y,P as V,b as B,H as W,O as z,N as T,a5 as U,x as H,k as m,h as c,i as A,p as S,z as J,X as j,Y as Q,a4 as X,Q as q,B as G,d as K,_ as Z}from"./entry.e001551d.js";import{_ as M}from"./Icon.02350196.js";import{_ as ee}from"./Menu.c4bdadcb.js";import{u as te}from"./useNotify.ee45f36b.js";const se={class:"fm_breadcrumbs"},ne={key:1},oe={__name:"Breadcrumbs",props:{items:Array},setup(l){const e=l;let t=E(0);e.items&&_(),Y(()=>e.items,()=>_());function _(){t.value=e.items.length-1}return(n,p)=>{const b=V,k=M;return s(),a("div",se,[(s(!0),a(h,null,C(l.items,(f,r)=>(s(),a(h,{key:r},[f.disabled?(s(),a("div",ne,u(f.text),1)):(s(),g(b,{key:0,class:"fm_breadcrumbs_items",to:f.to},{default:d(()=>[I(u(f.text),1)]),_:2},1032,["to"])),i(t)!=r?(s(),g(k,{key:2,class:"fm_breadcrumbs_devider",icon:"east"})):y("",!0)],64))),128))])}}},ae=F(oe,[["__scopeId","data-v-483c4927"]]);const _e={class:"flex aic height-100"},re={class:"fm_list"},ie={class:"flex sb"},ce={class:"fm_message_item_date"},le={class:"fm_message_item_section"},de={class:"fm_message_item_h"},ue={class:"fm_message_item_t"},me={class:"tac p-8"},pe=I("Show ALL"),he={key:1,class:"p-16"},fe=["href"],ve=["href"],ye={class:"fm_list"},ge=["onClick"],be={class:"fm_list"},ke=["onClick"],we={__name:"TheHeader",setup(l){const e=B(),t=W(),_={1:"Events",2:"Transactions",3:"Instruments",4:"Data",5:"Prices",6:"Report",7:"Import",8:"Activity log",9:"Schedules",10:"Other"};let n=E([{name:"Profile",cb:()=>{z("/profile")}},{name:"Logout",cb:()=>{T("access_token").value=null,T("refresh_token").value=null,window.location.href="/logout"}}]),p=E(null);U(()=>{e.current.base_api_url&&b()});async function b(r){let v=await H("systemMessages.get",{filters:{only_new:!0}});if(v.error)return!1;p.value=v.results.filter(N=>!N.is_pinned).slice(0,3)}function k(r){return S().diff(S(r),"hours")>12?S(r).format("DD.MM.YYYY HH:mm"):S(r).fromNow()}async function f(r){await H("masterSet.patch",{params:{id:r}})&&(window.location.href=t.public.oldAppURL)}return(r,v)=>{const N=ae,$=M,O=J,L=ee;return s(),a("header",null,[m(N,{items:r.$route.meta.bread},null,8,["items"]),c("div",_e,[i(e).current.name&&!r.$route.path.includes("/profile")?(s(),a(h,{key:0},[i(p)?(s(),g(L,{key:0,class:"header_item header_icon_btn"},{btn:d(({isOpen:o})=>[m($,{class:A(["noti_icon",{active:i(p).length}]),btn:"",icon:"notifications"},null,8,["class"])]),default:d(()=>[c("div",re,[i(p).length?(s(),a(h,{key:0},[(s(!0),a(h,null,C(i(p),(o,w)=>(s(),a("div",{class:"fm_message_item",key:w},[c("div",ie,[c("div",ce,u(k(o.created)),1),c("div",le,u(_[o.section]),1)]),c("div",de,u(o.title),1),c("div",ue,u(o.description.length>65?o.description.slice(0,65)+"...":o.description),1)]))),128)),c("div",me,[m(O,{to:"/",type:"action"},{default:d(()=>[pe]),_:1})])],64)):(s(),a("div",he,"No new messages"))])]),_:1})):y("",!0),c("a",{href:`${i(t).public.apiURL}/a/#!/processes`},[m($,{icon:"cloud_download",btn:"",tooltip:"Open Active Processes",class:"header_item header_icon_btn"})],8,fe),c("a",{href:`${i(t).public.apiURL}/documentation`},[m($,{icon:"help",btn:"",tooltip:"Open help menu",class:"header_item header_icon_btn"})],8,ve)],64)):y("",!0),i(e).current.name&&r.$route.name==="profile"?(s(),g($,{key:1,class:"header_item header_icon_btn",btn:"",tooltip:"Homepage",icon:"home",onClick:v[0]||(v[0]=o=>r.$router.push("/"))})):y("",!0),i(e).current.name?(s(),g(L,{key:2,class:"header_item height-100"},{btn:d(({isOpen:o})=>[m(O,{type:"text",class:A(["header_text","m-l-4","m-r-4",{active:o}]),style:{height:"100%"}},{default:d(()=>[I(u(i(e).current.name),1)]),_:2},1032,["class"])]),default:d(()=>[c("div",ye,[(s(!0),a(h,null,C(i(e).masterUsers,(o,w)=>(s(),a("div",{class:"fm_list_item",key:w,onClick:R=>f(o.id)},u(o.name),9,ge))),128))])]),_:1})):y("",!0),m(L,{class:"header_item height-100"},{btn:d(({isOpen:o})=>[m(O,{type:"text",class:A(["header_text",{active:o}]),style:{height:"100%"},icon:"account_box"},{default:d(()=>[I(u(i(e).user.username),1)]),_:2},1032,["class"])]),default:d(()=>[c("div",be,[(s(!0),a(h,null,C(i(n),(o,w)=>(s(),a("div",{class:"fm_list_item",key:w,onClick:R=>o.cb()},u(o.name),9,ke))),128))])]),_:1})])])}}},xe=F(we,[["__scopeId","data-v-b6ee04fd"]]);class $e{constructor(e){x(this,"_streams",{});x(this,"_pingInterval",null);x(this,"_ws",null);x(this,"_stack",{});this._ws=new WebSocket(e.url),this._onMessage(),this._onOpen(),this._onClose(),this._onError()}on(e,t){this._stack[e]||(this._stack[e]=[]),this._stack[e].push(t)}off(e,t){if(this._stack[e]){let _=this._stack[e].findIndex(n=>n==t);console.log("index:",_)}}send(e){return this._ws.send(JSON.stringify(e))}_onMessage(){this._ws.onmessage=async e=>{if(e.data=="pong")return!1;let t=JSON.parse(e.data);if(!t.type)return!1;let _=t.type;if(!_||!this._stack[_])return!1;this._stack[_].forEach(n=>{n(t.payload)})}}_onOpen(e){this._ws.onopen=async t=>{console.log("[WebSocket] Open")},this._pingInterval=setInterval(t=>{this._ws.send("ping")},3e4)}_onClose(e){this._ws.onclose=async t=>{console.log("[WebSocket] Close"),clearInterval(this._pingInterval)}}_onError(){this._ws.onerror=async e=>{console.log("[WebSocket] Error")}}destroy(){this._ws.close(),clearInterval(this._pingInterval)}}const Se=K(()=>Z(()=>import("./TheSidebar.d2af59f3.js"),["TheSidebar.d2af59f3.js","entry.e001551d.js","entry.869cdbc9.css","Icon.02350196.js","useNotify.ee45f36b.js","logo.36ce2e32.js"],import.meta.url)),Ce={class:"wrap"},Ie={class:"main"},Ne={class:"content"},Oe={__name:"default",async setup(l){let e,t,_=B();j("sidenav_width","$vjvaAYgdFa"),[e,t]=Q(()=>_.init()),await e,t(),_.ws=new $e({url:"wss://dev.finmars.com/ws/"});try{_.ws.send({action:"initial_auth",data:{access_token:T("access_token").value}})}catch(n){console.log("e:",n)}return X(()=>{let n=B();n.current.base_api_url?n.getMe().then(p=>{n.ws.send({action:"update_user_state",data:{member:n.member}}),n.ws.send({action:"update_user_state",data:{master_user:{id:n.current.current_master_user_id}}})}):(te({title:"Workspace is not selected",type:"warn"}),q().push("/profile"))}),(n,p)=>{const b=Se,k=xe;return s(),a("div",Ce,[n.$route.meta.isHideSidebar?y("",!0):(s(),g(b,{key:0})),c("div",Ie,[m(k),c("div",Ne,[G(n.$slots,"default",{},void 0,!0)])])])}}},Fe=F(Oe,[["__scopeId","data-v-becd1e07"]]);export{Fe as default};
