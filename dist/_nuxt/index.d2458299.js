import{_ as Ce}from"./Select.1492975e.js";import{_ as Se}from"./Icon.02350196.js";import{_ as $e}from"./Input.5f2d228f.js";import{_ as Me}from"./Menu.c4bdadcb.js";import{_ as Ie}from"./Loader.41d82123.js";import{a as de,b as ie,p as z,r as p,x as m,o as i,f as c,h as s,k as u,u as a,j as k,w as I,c as Q,l as x,D as Te,t as r,i as E,m as h,F,y as W,E as le,G as ce,H as Ae,q as _e,s as re}from"./entry.e001551d.js";const v=w=>(_e("data-v-addebb8c"),w=w(),re(),w),Ye={class:"hp_block notifications"},De=v(()=>s("div",{class:"hp_title"},"Notifications",-1)),Ee={class:"hp_toolbar flex sb aic"},Ve={class:"flex aic"},Oe={class:"flex aic"},Be={key:0,class:"hp_row hp_messages_stats flex sb aic"},Ne={class:"flex aic"},je={class:"hp_back"},Le={class:"hp_item no_hover"},qe={class:"hp_text_small"},Fe={class:"flex aic"},He=v(()=>s("div",{class:"hp_text_small"},"Errors",-1)),Re=v(()=>s("span",{class:"circle red"},null,-1)),Ue=v(()=>s("div",{class:"hp_text_small"},"Warning",-1)),Pe=v(()=>s("span",{class:"circle primary"},null,-1)),ze=v(()=>s("div",{class:"hp_text_small"},"Information",-1)),We=v(()=>s("span",{class:"circle blue"},null,-1)),Ke=v(()=>s("div",{class:"hp_text_small"},"Success",-1)),Ge=v(()=>s("span",{class:"circle green"},null,-1)),Je={class:"fm_list"},Qe=["onClick"],Xe=h(" Hide all details "),Ze=["onClick"],es=h(" Mark all as read "),ss={class:"hp_item_wrap"},ts=["onClick"],ns={class:"hp_text_small"},os={class:"flex aic"},as=["onClick"],is=v(()=>s("div",{class:"hp_text_small"},"Errors",-1)),ls={key:0},cs=v(()=>s("span",{class:"circle red"},null,-1)),ds={key:1},_s=["onClick"],rs=v(()=>s("div",{class:"hp_text_small"},"Warning",-1)),us={key:0},vs=v(()=>s("span",{class:"circle primary"},null,-1)),ps={key:1},hs=["onClick"],fs=v(()=>s("div",{class:"hp_text_small"},"Information",-1)),ms={key:0},ks=v(()=>s("span",{class:"circle blue"},null,-1)),ys={key:1},bs=["onClick"],gs=v(()=>s("div",{class:"hp_text_small"},"Success",-1)),xs={key:0},ws=v(()=>s("span",{class:"circle green"},null,-1)),Cs={key:1},Ss={class:"fm_list"},$s=["onClick"],Ms=h(" Watch stream "),Is=["onClick"],Ts=h(" Mark all as read "),As=["data-id"],Ys={class:"flex sb"},Ds={class:"hp_messages_text"},Es={class:"flex"},Vs={class:"status_wrap flex aic jcfe"},Os={key:0,class:"m-r-10"},Bs={class:"status"},Ns={class:"flex sb"},js=["onClick"],Ls={key:1},qs={class:"hp_messages_date"},Fs={key:0,class:"hp_details"},Hs={key:0,class:"hp_actions"},Rs={class:"hp_actions_item flex"},Us=v(()=>s("div",{class:"hp_actions_item_h"},"Instrument:",-1)),Ps={class:"hp_actions_item_t"},zs=v(()=>s("b",null,"Available actions",-1)),Ws=v(()=>s("br",null,null,-1)),Ks=["onClick"],Gs={key:1,class:"hp_attach"},Js=v(()=>s("b",{class:"m-t-10 db"},"Attachments",-1)),Qs={class:"hp_attach_item_type"},Xs=["href"],Zs={class:"more_menu"},et={class:"fm_list"},st=["onClick"],tt=["onClick"],nt=h(" Solved "),ot={__name:"notifications",setup(w){const X={1:"Action not required",2:"Action required",3:"Solved"},Z={1:"Events",2:"Transactions",3:"Instruments",4:"Data",5:"Prices",6:"Report",7:"Import",8:"Activity log",9:"Schedules",10:"Other"},K=ie();let ue=[{id:"",name:"All"},{id:z().add(-1,"d").format("YYYY-MM-DD"),name:"Last day"},{id:z().add(-7,"d").format("YYYY-MM-DD"),name:"Last 7 days"},{id:z().add(-30,"d").format("YYYY-MM-DD"),name:"Last month"}],ve=[{id:"",name:"All actions"},{id:1,name:"Action not required"},{id:2,name:"Action required"},{id:3,name:"Solved"}],y=p(""),S=p(""),H=p("-created"),b=p(!0),$=p(""),g=p(new Set);async function G(){n.value?A(!0):B()}async function J(){n.value&&A(!0),B()}let ee=p([]);B();async function B(){let o={query:y.value,only_new:b.value};S.value&&(o.created_after=S.value),$.value&&(o.action_status=$.value);let t=await m("systemMessagesStats.get",{filters:o});t.unshift({id:0,errors:0,information:0,name:"All",success:0,warning:0,total:0}),t.forEach((l,d)=>{l.total=l.errors+l.success+l.warning+l.information,t[0].errors+=l.errors,t[0].information+=l.information,t[0].success+=l.success,t[0].warning+=l.warning,t[0].total+=l.total}),ee.value=t,n.value&&(n.value=t.find(l=>l.id==n.value.id))}async function se(o){(await m("systemMessagesRead.post",{body:o!==0?{sections:[o]}:null})).status=="ok"&&(B(),f.value.forEach(l=>{l.is_read=!0}))}let n=p(null),f=p([]),R=1,N=p(!0),T=p(null),V,j=p(null),te=p(null);function ne(){n.value&&(H.value=H.value=="created"?"-created":"created",A(!0))}async function A(o){T.value||he(),o&&(R=1,N.value=!0,j.value.scrollTo({top:0,behavior:"smooth"}),T.value&&T.value.disconnect());let t={query:y.value,page:R,ordering:H.value};g.value&&(t.type=[...g.value].join(",")),S.value&&(t.created_after=S.value),$.value&&(t.action_status=$.value),b.value&&(t.only_new=b.value),n.value.id!==0&&(t.section=n.value.id);let l=await m("systemMessages.get",{filters:t});f.value=o?l.results:f.value.concat(l.results),l.next?(++R,V||pe()):N.value=!1}function pe(){let o={root:j.value,threshold:.5},t=(l,d)=>{l.forEach(Y=>{if(Y.isIntersecting){if(!N.value)return!1;A()}})};V=new IntersectionObserver(t,o),V.observe(te.value)}const oe={1:"information",2:"warnings",3:"errors",4:"success"};function he(){let o={root:j.value,rootMargin:"0px",threshold:1},t=[],l=null,d=async(Y,L)=>{Y.forEach(async q=>{if(q.isIntersecting){L.unobserve(q.target);let e=q.target.dataset.id;t.push(e),setTimeout(()=>{let C=f.value.findIndex(_=>_.id==e);C!==void 0&&(f.value[C].is_read=!0,n.value[oe[f.value[C].type]]>0&&(n.value[oe[f.value[C].type]]-=1),n.value.total>0&&(n.value.total-=1))},200),l||(l=setTimeout(()=>{m("systemMessagesRead.post",{body:{ids:t}}),l=null,t=[]},2e3))}})};T.value=new IntersectionObserver(d,o)}let U=p(0);K.ws.on("new_system_message",async o=>{if(n.value&&(o.section==n.value.id||n.value.id==0)){let t=await m("systemMessagesOne.get",{params:{id:o.id}});if(t.error)return!1;let d=f.value.filter(Y=>Y.is_pinned).length;f.value.splice(d,0,t),U.value+=1}});function ae(){j.value.scrollTo({top:0,behavior:"smooth"}),U.value=0}let O=p(new Set),P=p({});function fe(){O.value=new Set}async function me(o){(await m("systemMessagesPin.post",{body:{ids:[o.id]}})).status=="ok"&&(o.is_pinned=!0)}async function ke(o){(await m("systemMessagesUnpin.post",{body:{ids:[o.id]}})).status=="ok"&&(o.is_pinned=!1)}async function ye(o){(await m("systemMessagesSolved.post",{body:{ids:[o.id]}})).status=="ok"&&(o.action_status=3)}function M(o){g.value.has(o)?g.value.delete(o):g.value.add(o),A(!0)}async function be(o){if(O.value.has(o.id))O.value.delete(o.id);else if(O.value.add(o.id),o.linked_event){let t=await m("instrumentsEvent.get",{params:{id:o.linked_event}});P.value[o.linked_event]=t}}async function ge(o,t){let l=await m("instrumentsEventBook.get",{params:{id:o},filters:{action:t}}),d=await m("instrumentsEventBook.put",{params:{id:o},filters:{action:t,event_status:4},body:l});console.log("res2:",d)}function xe(){T.value&&T.value.disconnect(),V&&(V.disconnect(),V=null),n.value=null,f.value=[],g.value=new Set,R=1,N.value=!0,B(),ae()}function we(o){return z(o).format("DD.MM.YYYY HH:mm")}return(o,t)=>{const l=Ce,d=Se,Y=$e,L=Me,q=Ie;return i(),c("div",Ye,[De,s("div",Ee,[s("div",Ve,[u(l,{modelValue:a($),"onUpdate:modelValue":[t[0]||(t[0]=e=>k($)?$.value=e:$=e),t[1]||(t[1]=e=>J())],items:a(ve),size:"small",class:"m-b-0"},null,8,["modelValue","items"]),u(Y,{type:"text",modelValue:a(y),"onUpdate:modelValue":t[3]||(t[3]=e=>k(y)?y.value=e:y=e),placeholder:"Search",class:"bi_no_borders",onKeyup:t[4]||(t[4]=Te(e=>G(),["enter"])),onChange:t[5]||(t[5]=e=>G())},{button:I(()=>[u(d,{icon:"search"})]),rightBtn:I(()=>[a(y)?(i(),Q(d,{key:0,size:"16",icon:"close",onClick:t[2]||(t[2]=e=>(k(y)?y.value="":y="",G()))})):x("",!0)]),_:1},8,["modelValue"])]),s("div",Oe,[a(n)?(i(),Q(d,{key:0,icon:"today",onClick:t[6]||(t[6]=e=>ne())})):x("",!0),a(n)?(i(),Q(d,{key:1,icon:a(H)=="created"?"south":"north",size:"20",onClick:t[7]||(t[7]=e=>ne())},null,8,["icon"])):x("",!0),u(l,{modelValue:a(S),"onUpdate:modelValue":[t[8]||(t[8]=e=>k(S)?S.value=e:S=e),t[9]||(t[9]=e=>J())],items:a(ue),class:"m-b-0",no_borders:""},null,8,["modelValue","items"]),u(d,{icon:a(b)?"visibility":"visibility_off",tooltip:(a(b)?"Show":"Hide")+" read messages",onClick:t[10]||(t[10]=e=>(k(b)?b.value=!a(b):b=!a(b),J()))},null,8,["icon","tooltip"])])]),a(n)?(i(),c("div",Be,[s("div",Ne,[s("div",je,[u(d,{icon:"arrow_back",onClick:t[11]||(t[11]=e=>xe())})]),s("div",Le,[s("div",null,r(a(n).name),1),s("div",qe,"Total new: "+r(a(n).total),1)])]),s("div",Fe,[s("div",{class:E(["hp_item red",{active:a(g).has(3)}]),onClick:t[12]||(t[12]=e=>M(3))},[He,s("div",null,[Re,h(r(a(n).errors),1)])],2),s("div",{class:E(["hp_item primary",{active:a(g).has(2)}]),onClick:t[13]||(t[13]=e=>M(2))},[Ue,s("div",null,[Pe,h(r(a(n).warning),1)])],2),s("div",{class:E(["hp_item blue",{active:a(g).has(1)}]),onClick:t[14]||(t[14]=e=>M(1))},[ze,s("div",null,[We,h(r(a(n).information),1)])],2),s("div",{class:E(["hp_item green",{active:a(g).has(4)}]),onClick:t[15]||(t[15]=e=>M(4))},[Ke,s("div",null,[Ge,h(r(a(n).success),1)])],2)]),u(L,{class:"header_item",anchor:"right"},{btn:I(()=>[u(d,{icon:"more_vert"})]),default:I(({close:e})=>[s("div",Je,[s("div",{class:"fm_list_item",onClick:C=>(fe(),e())},[u(d,{class:"m-r-10",icon:"playlist_remove"}),Xe],8,Qe),s("div",{class:"fm_list_item",onClick:C=>(se(a(n).id),e())},[u(d,{class:"m-r-10",icon:"mark_email_read"}),es],8,Ze)])]),_:1})])):x("",!0),s("div",{class:E(["hp_content scrollable",{opened:a(n)}]),ref_key:"scrolledBox",ref:j},[a(n)?(i(),c(F,{key:1},[a(U)?(i(),c("div",{key:0,class:"hp_new_message",onClick:t[16]||(t[16]=e=>ae())},[u(d,{icon:"north"}),h("New messages: "+r(a(U)),1)])):x("",!0),(i(!0),c(F,null,W(a(f),(e,C)=>(i(),c("div",{class:E(["hp_messages",{blue:e.type==1,primary:e.type==2,red:e.type==3,green:e.type==4,pinned:e.is_pinned}]),key:e.id,"data-id":e.id,ref_for:!0,ref:_=>{_&&!e.is_read&&a(T).observe(_)}},[s("div",Ys,[s("div",Ds,[s("b",null,r(e.title?e.title+": ":""),1),h(" "+r(e.description),1)]),s("div",Es,[s("div",null,[s("div",{class:E(["action_status",{primary:e.action_status==2}])},r(X[e.action_status]),3),s("div",Vs,[a(n).id===0?(i(),c("b",Os,r(Z[e.section]),1)):x("",!0),le(s("div",Bs,"New",512),[[ce,!e.is_read]])])])])]),s("div",Ns,[e.linked_event||e.attachments.length?(i(),c("div",{key:0,class:"hp_details_btn",onClick:_=>be(e)},r(a(O).has(e.id)?"Hide":"Show")+" details",9,js)):(i(),c("div",Ls)),s("div",qs,r(we(e.created)),1)]),(e.linked_event||e.attachments.length)&&a(O).has(e.id)?(i(),c("div",Fs,[a(P)[e.linked_event]?(i(),c("div",Hs,[s("div",Rs,[Us,s("div",Ps,r(a(P)[e.linked_event].instrument_object.name),1)]),zs,Ws,(i(!0),c(F,null,W(a(P)[e.linked_event].event_schedule_object.actions,(_,D)=>(i(),c("div",{class:"hp_actions_item_btn",key:D,onClick:_t=>ge(e.linked_event,_.id)},r(_.display_text),9,Ks))),128))])):x("",!0),e.attachments.length?(i(),c("div",Gs,[Js,(i(!0),c(F,null,W(e.attachments,(_,D)=>(i(),c("div",{class:"hp_attach_item flex aic",key:D},[s("div",Qs,r(_.file_report_object.content_type||"JSON"),1),s("a",{class:"hp_attach_item_name",href:`${a(Ae)().public.apiURL}/${a(ie)().current.base_api_url}/api/v1/file-reports/file-report/${_.file_report_object.id}/view/`},r(_.file_report_object.name),9,Xs)]))),128))])):x("",!0)])):x("",!0),s("div",Zs,[u(L,{class:"header_item",anchor:"right"},{btn:I(()=>[u(d,{icon:"more_vert"})]),default:I(({close:_})=>[s("div",et,[s("div",{class:"fm_list_item",onClick:D=>(e.is_pinned?ke(e):me(e),_())},[u(d,{class:"m-r-10",icon:"push_pin"}),h(" "+r(e.is_pinned?"Unpin":"Pin")+" message ",1)],8,st),e.action_status!=3?(i(),c("div",{key:0,class:"fm_list_item",onClick:D=>(ye(e),_())},[u(d,{class:"m-r-10",icon:"check_circle"}),nt],8,tt)):x("",!0)])]),_:2},1024)])],10,As))),128)),le(s("div",{class:"hp_messages_loader tac p-t-16",ref_key:"messagesLoader",ref:te},[u(q)],512),[[ce,a(N)]])],64)):(i(!0),c(F,{key:0},W(a(ee),(e,C)=>(i(),c("div",{class:"hp_row flex sb aic",key:C},[s("div",ss,[s("div",{class:"hp_item",onClick:_=>(k(n)?n.value=e:n=e,A())},[s("div",null,r(e.name),1),s("div",ns,"Total new: "+r(e.total),1)],8,ts)]),s("div",os,[s("div",{class:"hp_item red",onClick:_=>(k(n)?n.value=e:n=e,M(3))},[is,e.errors?(i(),c("div",ls,[cs,h(r(e.errors),1)])):(i(),c("div",ds,"-"))],8,as),s("div",{class:"hp_item primary",onClick:_=>(k(n)?n.value=e:n=e,M(2))},[rs,e.warning?(i(),c("div",us,[vs,h(r(e.warning),1)])):(i(),c("div",ps,"-"))],8,_s),s("div",{class:"hp_item blue",onClick:_=>(k(n)?n.value=e:n=e,M(1))},[fs,e.information?(i(),c("div",ms,[ks,h(r(e.information),1)])):(i(),c("div",ys,"-"))],8,hs),s("div",{class:"hp_item green",onClick:_=>(k(n)?n.value=e:n=e,M(4))},[gs,e.success?(i(),c("div",xs,[ws,h(r(e.success),1)])):(i(),c("div",Cs,"-"))],8,bs)]),u(L,{class:"header_item",anchor:"bottom left"},{btn:I(()=>[u(d,{icon:"more_vert"})]),default:I(({close:_})=>[s("div",Ss,[s("div",{class:"fm_list_item",onClick:D=>(k(n)?n.value=e:n=e,A(),_())},[u(d,{class:"m-r-10",icon:"smart_display"}),Ms],8,$s),s("div",{class:"fm_list_item",onClick:D=>(se(e.id),_())},[u(d,{class:"m-r-10",icon:"mark_email_read"}),Ts],8,Is)])]),_:2},1024)]))),128))],2)])}}},at=de(ot,[["__scopeId","data-v-addebb8c"]]);const it=w=>(_e("data-v-ac4dc1b1"),w=w(),re(),w),lt={class:"fm_container wrap"},ct=it(()=>s("div",{class:"hp_block"},[s("div",{class:"hp_title"},"Bookmarks"),s("div",{class:"hp_content"},[s("div",{style:{padding:"10px 20px"}},"Coming soon")])],-1)),dt={__name:"index",setup(w){return(X,Z)=>{const K=at;return i(),c("div",lt,[u(K),ct])}}},mt=de(dt,[["__scopeId","data-v-ac4dc1b1"]]);export{mt as default};
